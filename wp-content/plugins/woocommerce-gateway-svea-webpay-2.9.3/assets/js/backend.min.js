jQuery(document).ready(function(e){if(e(document).on("click",".svea-credit-items",function(s){var r=e(".woocommerce_order_items tr[data-order_item_id] .check-column input[type='checkbox']:checked");if(0===r.length)return void alert(Phrases.not_selected_any_items);var t=[];r.each(function(){t.push(e(this).parents("tr[data-order_item_id]").data("order_item_id"))});var a=confirm(Phrases.confirm_credit_items.replace(/%d/g,t.length));a&&(window.location.href=Svea.adminCreditUrl+t.join(","))}),e(document).on("click",".svea-deliver-items",function(s){var r=e(".woocommerce_order_items tr[data-order_item_id] .check-column input[type='checkbox']:checked");if(0===r.length)return void alert(Phrases.not_selected_any_items);var t=[];r.each(function(){t.push(e(this).parents("tr[data-order_item_id]").data("order_item_id"))});var a=confirm(Phrases.confirm_deliver_items.replace(/%d/g,t.length));a&&(window.location.href=Svea.adminDeliverUrl+t.join(","))}),e("body").hasClass("post-type-shop_subscription")){var s=[],r=!1,t=!1,a={INVOICE:"sveawebpay_invoice",PART_PAY:"sveawebpay_part_pay",CARD:"sveawebpay_card",DIRECT_BANK:"sveawebpay_direct_bank"},o=e('.woocommerce select[name="_billing_country"]').val().toLowerCase(),n=e('.woocommerce select[name="_payment_method"]').val(),d=e('.woocommerce select[name="_iv_billing_customer_type"]').val().toLowerCase();0!=Svea.onlyOneAllowedCountry&&(o=Svea.onlyOneAllowedCountry.toLowerCase()),"undefined"!=typeof o&&0!=o&&o.length>0&&e(".svea-fields").addClass("country-"+o),"undefined"!=typeof n&&0!=n&&n.length>0&&e(".svea-fields").addClass("payment-method-"+n),"undefined"!=typeof d&&0!=d&&d.length>0&&e(".svea-fields").addClass("customer-type-"+d);var i=function(e){if(e.length<=0)return"";for(var s="",r=0;r<e.length;++r){var t=e[r];s+='<option value="'+t.addressSelector+'">',"business"==t.customerType.toLowerCase()?s+=t.fullName+", ":"person"==t.customerType.toLowerCase()&&(s+=t.lastName+", "+t.firstName+" "),s+=t.street+" "+t.zipCode+" "+t.locality+"</option>"}return s},l=function(s){String(s.firstName).length>0&&e("#_billing_first_name").val(String(s.firstName)),String(s.lastName).length>0&&e("#_billing_last_name").val(String(s.lastName)),"business"==String(s.customerType).toLowerCase()&&e("#_billing_company").val(String(s.fullName)),String(s.street).length>0&&e("#_billing_address_1").val(String(s.street)),String(s.coAddress).length>0&&e("#_billing_address_2").val(String(s.coAddress)),String(s.zipCode).length>0&&e("#_billing_postcode").val(String(s.zipCode)),String(s.locality).length>0&&e("#_billing_city").val(String(s.locality)),String(s.phoneNumber).length>0&&e("#_billing_phone").val(String(s.phoneNumber))};e(document).on("click",".svea-get-address-button",function(r){var c=e(this).parents(".svea-fields-admin"),m=c.find(".svea-get-address-button-container");if(r.preventDefault(),!t)if("individual"==d||n==a.PART_PAY){var v;v=n==a.INVOICE?"iv":"pp";var u=c.find("input[name='_"+v+"_billing_ssn']").val();c.addClass("getting-address"),t=!0,e.post(Svea.ajaxUrl,{action:"svea_get_address",pers_nr:u,country_code:o,payment_type:n,security:Svea.gaSecurity},function(e){if(c.removeClass("getting-address"),t=!1,"undefined"==typeof e.resultcode||"undefined"==typeof e.customerIdentity)return m.after('<div class="svea-message error">'+Phrases.could_not_get_address+"</div>"),c.addClass("getting-address-error"),void setTimeout(function(){c.find(".svea-message.error").remove(),c.removeClass("getting-address-error")},5e3);if("Error"==e.resultcode||"NoSuchEntity"==e.resultcode)return m.after('<div class="svea-message error">'+e.errormessage+"</div>"),c.addClass("getting-address-error"),void setTimeout(function(){c.find(".svea-message.error").remove(),c.removeClass("getting-address-error")},5e3);var s=e.customerIdentity[0];l(s),m.after('<div class="svea-message success">'+Phrases.your_address_was_found+"</div>"),c.addClass("getting-address-success"),setTimeout(function(){c.find(".svea-message.success").remove(),c.removeClass("getting-address-success")},5e3)})}else if("company"==d){var v;v=n==a.INVOICE?"iv":"pp";var g=c.find("input[name='_"+v+"_billing_org_number']").val();c.addClass("getting-address"),t=!0,e.post(Svea.ajaxUrl,{action:"svea_get_address",org_nr:g,country_code:o,payment_type:n,security:Svea.gaSecurity},function(r){if(c.removeClass("getting-address"),t=!1,"undefined"==typeof r.resultcode||"undefined"==typeof r.customerIdentity)return m.after('<div class="svea-message error">'+Phrases.could_not_get_address+"</div>"),c.addClass("getting-address-error"),void setTimeout(function(){c.find(".svea-message.error").remove(),c.removeClass("getting-address-error")},5e3);if("Error"==r.resultcode||"NoSuchEntity"==r.resultcode)return m.after('<div class="svea-message error">'+r.errormessage+"</div>"),c.addClass("getting-address-error"),void setTimeout(function(){c.find(".svea-message.error").remove(),c.removeClass("getting-address-error")},5e3);var a=r.customerIdentity;e(".org-address-selector").html(i(a)),s=a,e(".address-selector").val(a[0].addressSelector),l(a[0]),c.addClass("getting-address-success"),m.after('<div class="svea-message success">'+Phrases.your_address_was_found+"</div>"),setTimeout(function(){c.find(".svea-message.success").remove(),c.removeClass("getting-address-success")},5e3)})}}),e(document).on("change",".org-address-selector",function(){for(var t=0;t<s.length;++t){var a=s[t];if(a.addressSelector==e(".org-address-selector").val())return e(".address-selector").val(e(".org-address-selector").val()),l(a),void(r=a)}}),e(document).on("click",".woocommerce a.edit_address",function(s){e(".svea-fields").addClass("edit-opened")}),e(document).on("change",'.woocommerce select[name="_billing_country"]',function(s){e(".svea-fields").removeClass("country-"+o),o=e(this).val().toLowerCase(),e(".svea-fields").addClass("country-"+o)}),e(document).on("change",'.woocommerce select[name="_payment_method"]',function(s){e(".svea-fields").removeClass("payment-method-"+n),n=e(this).val(),e(".svea-fields").addClass("payment-method-"+n)}),e(document).on("change",'.woocommerce select[name="_iv_billing_customer_type"]',function(s){e(".svea-fields").removeClass("customer-type-"+d),d=e(this).val(),e(".svea-fields").addClass("customer-type-"+d)})}});