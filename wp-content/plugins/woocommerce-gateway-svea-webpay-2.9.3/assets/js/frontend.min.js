jQuery(document).ready(function(e){function s(e){if(e.length<=0)return"";for(var s="",a=0;a<e.length;++a){var t=e[a];s+='<option value="'+t.addressSelector+'">',"business"==t.customerType.toLowerCase()?s+=t.fullName+", ":"person"==t.customerType.toLowerCase()&&(s+=t.lastName+", "+t.firstName+" "),s+=t.street+" "+t.zipCode+" "+t.locality+"</option>"}return s}function a(s){String(s.firstName).length>0&&e("#billing_first_name").val(String(s.firstName)).change(),String(s.lastName).length>0&&e("#billing_last_name").val(String(s.lastName)).change(),"business"==String(s.customerType).toLowerCase()&&e("#billing_company").val(String(s.fullName)).change(),String(s.street).length>0&&e("#billing_address_1").val(String(s.street)).change(),String(s.coAddress).length>0&&e("#billing_address_2").val(String(s.coAddress)).change(),String(s.zipCode).length>0&&e("#billing_postcode").val(String(s.zipCode)).change(),String(s.locality).length>0&&e("#billing_city").val(String(s.locality)).change(),String(s.phoneNumber).length>0&&e("#billing_phone").val(String(s.phoneNumber)).change(),d=!0}function t(s){s?(e("#billing_address_1, #billing_address_2, #billing_postcode, \t\t\t\t#billing_city").prop("readonly",!1),e("#billing_address_1, #billing_address_2, #billing_postcode, \t\t\t\t#billing_city").removeClass("disabled-input")):(e("#billing_address_1, #billing_address_2, \t\t\t\t#billing_postcode, #billing_city").prop("readonly",!0),e("#billing_address_1, #billing_address_2, \t\t\t\t#billing_postcode, #billing_city").addClass("disabled-input"))}function n(e,s,a){switch(e){case"SE":case"DK":switch(s){case c.INVOICE:case c.PART_PAY:if("individual"===a)return!1}}return!0}function t(s){s?(e("#billing_first_name, #billing_last_name, #billing_address_1, \t\t\t\t#billing_address_2, #billing_postcode, #billing_city").prop("readonly",!1),e("#billing_first_name, #billing_last_name, #billing_address_1, \t\t\t\t#billing_address_2, #billing_postcode, #billing_city").removeClass("disabled-input")):(e("#billing_first_name, #billing_last_name, #billing_address_1, \t\t\t\t#billing_address_2, #billing_postcode, #billing_city").prop("readonly",!0),e("#billing_first_name, #billing_last_name, #billing_address_1, \t\t\t\t#billing_address_2, #billing_postcode, #billing_city").addClass("disabled-input"))}function i(){e("#billing_first_name, #billing_last_name, #billing_address_1, \t\t\t\t#billing_address_2, #billing_postcode, #billing_city").val([])}String.prototype.clone=function(){return JSON.parse(JSON.stringify(this))};var r=[],o=!1,d=!1,l=!1,c={INVOICE:"sveawebpay_invoice",PART_PAY:"sveawebpay_part_pay",CARD:"sveawebpay_card",DIRECT_BANK:"sveawebpay_direct_bank"},g=e('[name="payment_method"]:checked').val()||!1,m=e('[name="billing_country"]').val()||!1;if("undefined"!=typeof Svea.sameShippingAsBilling[g]&&Svea.sameShippingAsBilling[g]&&e(".woocommerce form.woocommerce-checkout").addClass("hide-shipping-fields"),0!=Svea.onlyOneAllowedCountry&&(m=Svea.onlyOneAllowedCountry),Svea.isPayPage){m=Svea.customerCountry;e(".payment_methods, .svea-get-address-button-container").addClass("is-pay-page")}e(".payment_methods, .svea-get-address-button-container").addClass("payment-method-"+g).addClass("country-"+(m?m.toLowerCase():"false"));var _=!1;e(".svea-get-address-button-container.get-address-shortcode").length>0&&(e(".payment_method_"+c.INVOICE).is(":visible")?e(".svea-get-address-button-container.get-address-shortcode").removeClass("invoice-not-available"):e(".svea-get-address-button-container.get-address-shortcode").addClass("invoice-not-available")),e(".svea-get-address-button-container.get-address-shortcode").is(":visible")&&(_=e("[name='svea_get_address_customer_type']:checked").val(),e('[name="iv_billing_customer_type"]').val(_),e(".payment_methods, .svea-get-address-button-container").addClass("customer-type-"+_)),n(m,g,_)?n(m,g,_)&&t(!0):(t(!1),d||i()),e(document).on("change",".woocommerce form.woocommerce-checkout .woocommerce-billing-fields :input",function(e){d=!1}),e(document).on("keydown",'[name="svea_billing_ssn"], [name="svea_billing_org_number"], [name="iv_billing_org_number"], [name="iv_billing_ssn"], [name="pp_billing_ssn"]',function(s){var a=e(s.target),t=s.which||s.keyCode||0;if(13==t){s.preventDefault(),$container=a.closest(".svea-fields, .svea-get-address-button-container");var n=$container.find(".svea-get-address-button");n.is(":visible")&&n.click()}}),e(document).on("change",'[name="svea_billing_ssn"]',function(s){e("[name='iv_billing_ssn'], [name='pp_billing_ssn']").val(e(this).val())}),e(document).on("change",'[name="svea_billing_org_number"]',function(s){e("[name='iv_billing_org_number'], [name='pp_billing_org_number']").val(e(this).val())}),e(document).on("click",".svea-get-address-button",function(t){t.preventDefault();var n=g,i=(e(this),e(this).closest(".svea-get-address-button-container")),d=e(".svea-get-address-button-container.get-address-shortcode").is(":visible");e(".svea-invoice-fields, .svea-part-pay-fields");if(!l)if(d&&(n=c.INVOICE),"individual"==_||n==c.PART_PAY){var v;if(d)v=e("[name='svea_billing_ssn']").val();else{var u;u=n==c.INVOICE?"iv":"pp",v=e("[name='"+u+"_billing_ssn']").val()}i.addClass("getting-address"),l=!0,e.post(Svea.ajaxUrl,{action:"svea_get_address",pers_nr:v,country_code:m,payment_type:n,security:Svea.gaSecurity},function(e){if(i.removeClass("getting-address"),l=!1,"undefined"==typeof e.resultcode||"undefined"==typeof e.customerIdentity)return i.append('<div class="svea-message error">'+Phrases.could_not_get_address+"</div>"),i.addClass("getting-address-error"),void setTimeout(function(){i.find(".svea-message.error").remove(),i.removeClass("getting-address-error")},5e3);if("Error"==e.resultcode||"NoSuchEntity"==e.resultcode)return i.append('<div class="svea-message error">'+e.errormessage+"</div>"),i.addClass("getting-address-error"),void setTimeout(function(){i.find(".svea-message.error").remove(),i.removeClass("getting-address-error")},5e3);var s=e.customerIdentity[0];a(s),i.append('<div class="svea-message success">'+Phrases.your_address_was_found+"</div>"),i.addClass("getting-address-success"),setTimeout(function(){i.find(".svea-message.success").remove(),i.removeClass("getting-address-success")},5e3)})}else if("company"==_){var p;if(d)p=e("[name='svea_billing_org_number']").val();else{var u;u=n==c.INVOICE?"iv":"pp",p=e("[name='"+u+"_billing_org_number']").val()}i.addClass("getting-address"),l=!0,e.post(Svea.ajaxUrl,{action:"svea_get_address",org_nr:p,country_code:m,payment_type:n,security:Svea.gaSecurity},function(t){if(i.removeClass("getting-address"),l=!1,"undefined"==typeof t.resultcode||"undefined"==typeof t.customerIdentity)return i.append('<div class="svea-message error">'+Phrases.could_not_get_address+"</div>"),i.addClass("getting-address-error"),void setTimeout(function(){i.find(".svea-message.error").remove(),i.removeClass("getting-address-error")},5e3);if("Error"==t.resultcode||"NoSuchEntity"==t.resultcode)return i.append('<div class="svea-message error">'+t.errormessage+"</div>"),i.addClass("getting-address-error"),void setTimeout(function(){i.find(".svea-message.error").remove(),i.removeClass("getting-address-error")},5e3);var n=t.customerIdentity;e(".org-address-selector").html(s(n)),r=n,e(".address-selector").val(n[0].addressSelector),a(n[0]),o=n[0],i.addClass("getting-address-success"),i.append('<div class="svea-message success">'+Phrases.your_address_was_found+"</div>"),setTimeout(function(){i.find(".svea-message.success").remove(),i.removeClass("getting-address-success")},5e3)})}}),Svea.isPayPage&&e('.payment_methods [name="payment_method"]').on("change",function(){var s=g||!1;g=e('[name="payment_method"]:checked').val(),_=e('[name="iv_billing_customer_type"]').val()||!1,e(".payment_methods, .svea-get-address-button-container").removeClass("payment-method-"+s).addClass("payment-method-"+g).removeClass("customer-type-"+_).addClass("customer-type-"+_),o=!1,r=[],e(".org-address-selector").html("")}),e(document).on("updated_checkout",function(){e(".svea-get-address-button-container.get-address-shortcode").length>0&&(e(".payment_method_"+c.INVOICE).is(":visible")?e(".svea-get-address-button-container.get-address-shortcode").removeClass("invoice-not-available"):e(".svea-get-address-button-container.get-address-shortcode").addClass("invoice-not-available")),e(".svea-get-address-button-container.get-address-shortcode").is(":visible")&&(e("[name='iv_billing_ssn'], [name='pp_billing_ssn']").val(e("[name='svea_billing_ssn']").val()),e("[name='iv_billing_org_number']").val(e("[name='svea_billing_org_number']").val()),e('[name="iv_billing_customer_type"]').val(e('[name="svea_get_address_customer_type"]:checked').val()));var a=m||!1,l=g||!1,v=_||!1;0==Svea.onlyOneAllowedCountry&&(m=e('[name="billing_country"]').val()),g=e('[name="payment_method"]:checked').val(),_=e('[name="iv_billing_customer_type"]').val()||!1,e(".payment_methods, .svea-get-address-button-container").removeClass("country-"+(a?a.toLowerCase():"false")).addClass("country-"+(m?m.toLowerCase():"false")).removeClass("payment-method-"+l).addClass("payment-method-"+g),e(".svea-get-address-button-container.get-address-shortcode").is(":visible")&&(_=e('[name="iv_billing_customer_type"]').val()||!1),e(".payment_methods, .svea-get-address-button-container").removeClass("customer-type-"+v).addClass("customer-type-"+_),o!==!1&&r.length>0&&(e(".org-address-selector").html(s(r)),e(".org-address-selector").val(o.addressSelector),e(".address-selector").val(o.addressSelector)),"undefined"!=typeof Svea.sameShippingAsBilling[g]&&Svea.sameShippingAsBilling[g]?e(".woocommerce .woocommerce-checkout").hasClass("hide-shipping-fields")||e(".woocommerce .woocommerce-checkout").addClass("hide-shipping-fields"):e(".woocommerce .woocommerce-checkout").hasClass("hide-shipping-fields")&&e(".woocommerce .woocommerce-checkout").removeClass("hide-shipping-fields"),a===m&&g===l||(o=!1,r=[],e(".org-address-selector").html(""),n(m,g,_)?n(m,g,_)&&t(!0):(t(!1),d||i()))}),e(document).on("change",'[name="payment_method"]',function(){e("body").trigger("update_checkout")}),e(document).on("change",'[name="billing_country"]',function(){var s=m||!1;m=e('[name="billing_country"]').val(),e(".payment_methods, .svea-get-address-button-container").removeClass("country-"+(s?s.toLowerCase():"false")).addClass("country-"+(m?m.toLowerCase():"false")),n(m,g,_)?n(m,g,_)&&t(!0):(t(!1),d||i())});var v=null;e(document).on("change",'[name="iv_billing_customer_type"], [name="svea_get_address_customer_type"]',function(){if(l)return void(null!=v&&e(this).val(v.val()));var s=_||!1;_=e(this).val()||!1,e(".payment_methods, .svea-get-address-button-container").removeClass("customer-type-"+s).addClass("customer-type-"+_),v=e(this),n(m,g,_)?n(m,g,_)&&t(!0):(t(!1),d||i())}),e(document).on("change",'[name="svea_get_address_customer_type"]',function(){e("[name='iv_billing_customer_type']").val(e(this).val()),v=e(this),e("body").trigger("update_checkout")}),e(document).on("change",".org-address-selector",function(){for(var s=0;s<r.length;++s){var t=r[s];if(t.addressSelector==e(".org-address-selector").val())return e(".address-selector").val(e(".org-address-selector").val()),a(t),void(o=t)}}),e(document).on("change",".birth-date-month, .birth-date-day, .birth-date-year",function(){var s=e(this).parents(".svea-part-pay-fields, .svea-invoice-fields"),a=parseInt(s.find(".birth-date-year").val()),t=parseInt(s.find(".birth-date-month").val()),n=parseInt(s.find(".birth-date-day").val()),i=new Date(a,t,0),r=i.getDate();s.find(".birth-date-day option").each(function(){parseInt(e(this).val())>r?e(this).prop("disabled",!0):e(this).prop("disabled",!1)}),n>r&&s.find(".birth-date-day").val(r)})});